{
	"info": {
		"_postman_id": "nutritrack-unit-tests-demo",
		"name": "NutriTrack - Demo Unit Tests (RN30, RN31, RN32)",
		"description": "Colecci√≥n de demostraci√≥n para exponer las 3 reglas de negocio implementadas con unit tests:\n\n**RN30 - Validaci√≥n de Email RFC 5322 + DNS:**\n- Email con formato inv√°lido (sin @)\n- Email con dominio inexistente\n- Email v√°lido con DNS verificado\n\n**RN31 - Pol√≠tica de Contrase√±as Robusta:**\n- Contrase√±a corta (< 12 caracteres)\n- Contrase√±a sin complejidad\n- Contrase√±a com√∫n (blacklist)\n- Contrase√±a que contiene email\n- Contrase√±a v√°lida\n\n**RN32 - Validaci√≥n Cruzada de Al√©rgenos:**\n- Usuario con alergia intenta activar plan con al√©rgeno\n- Usuario sin alergias activa plan exitosamente\n\n**Nota:** Esta colecci√≥n est√° dise√±ada para demostrar las validaciones implementadas.\nTodas las validaciones tienen unit tests que corren con `./mvnw test` (175/175 ‚úÖ)",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:8080",
			"type": "string"
		},
		{
			"key": "userToken",
			"value": "",
			"type": "string"
		}
	],
	"item": [
		{
			"name": "RN30 - Validaci√≥n de Email",
			"description": "Demostraci√≥n de validaci√≥n de formato de email RFC 5322 + verificaci√≥n DNS",
			"item": [
				{
					"name": "‚ùå Email sin formato v√°lido (sin @)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('RN30: Rechaza email sin @', function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test('Mensaje de error contiene validaci√≥n', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.message).to.include('email');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"usuariosinformato\",\n  \"password\": \"TestPass123!\",\n  \"nombre\": \"Usuario\",\n  \"apellido\": \"Test\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/register",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"auth",
								"register"
							]
						}
					},
					"response": []
				},
				{
					"name": "‚ùå Email con dominio inexistente (DNS Fail)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('RN30: Rechaza dominio inexistente (DNS lookup)', function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test('Mensaje indica dominio no existe', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.message).to.include('dominio').or.include('existe');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"usuario@dominioquenoexiste99999.com\",\n  \"password\": \"TestPass123!\",\n  \"nombre\": \"Usuario\",\n  \"apellido\": \"Test\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/register",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"auth",
								"register"
							]
						}
					},
					"response": []
				},
				{
					"name": "‚úÖ Email v√°lido con DNS verificado",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('RN30: Acepta email v√°lido RFC 5322 con DNS', function () {",
									"    // 201 Created o 400 si el email ya existe",
									"    pm.expect(pm.response.code).to.be.oneOf([201, 400]);",
									"});",
									"",
									"if (pm.response.code === 201) {",
									"    pm.test('Usuario creado exitosamente', function () {",
									"        var jsonData = pm.response.json();",
									"        pm.expect(jsonData.status).to.eql('success');",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"test.rn30@gmail.com\",\n  \"password\": \"TestPass123!\",\n  \"nombre\": \"Usuario\",\n  \"apellido\": \"RN30\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/register",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"auth",
								"register"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "RN31 - Pol√≠tica de Contrase√±as Robusta",
			"description": "Demostraci√≥n de validaci√≥n de contrase√±as con 12+ caracteres y complejidad requerida",
			"item": [
				{
					"name": "‚ùå Contrase√±a corta (< 12 caracteres)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('RN31: Rechaza contrase√±a < 12 caracteres', function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test('Mensaje indica m√≠nimo 12 caracteres', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.message).to.include('12');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"test.rn31.corta@gmail.com\",\n  \"password\": \"Short1!\",\n  \"nombre\": \"Usuario\",\n  \"apellido\": \"Test\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/register",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"auth",
								"register"
							]
						}
					},
					"response": []
				},
				{
					"name": "‚ùå Contrase√±a sin complejidad (solo lowercase)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('RN31: Rechaza contrase√±a sin complejidad', function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test('Mensaje indica requisitos de complejidad', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.message).to.match(/may√∫scula|min√∫scula|n√∫mero|s√≠mbolo/i);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"test.rn31.simple@gmail.com\",\n  \"password\": \"solominusculas\",\n  \"nombre\": \"Usuario\",\n  \"apellido\": \"Test\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/register",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"auth",
								"register"
							]
						}
					},
					"response": []
				},
				{
					"name": "‚ùå Contrase√±a com√∫n (blacklist)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('RN31: Rechaza contrase√±a com√∫n (blacklist)', function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test('Mensaje indica contrase√±a com√∫n', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.message).to.include('com√∫n').or.include('segura');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"test.rn31.blacklist@gmail.com\",\n  \"password\": \"password1234\",\n  \"nombre\": \"Usuario\",\n  \"apellido\": \"Test\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/register",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"auth",
								"register"
							]
						}
					},
					"response": []
				},
				{
					"name": "‚ùå Contrase√±a que contiene email",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('RN31: Rechaza contrase√±a con email', function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test('Mensaje indica no usar email', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.message).to.include('email');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"carlos@gmail.com\",\n  \"password\": \"Carlos12345!\",\n  \"nombre\": \"Carlos\",\n  \"apellido\": \"Test\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/register",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"auth",
								"register"
							]
						}
					},
					"response": []
				},
				{
					"name": "‚úÖ Contrase√±a v√°lida (12+ chars + complejidad)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('RN31: Acepta contrase√±a robusta', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([201, 400]);",
									"});",
									"",
									"if (pm.response.code === 201) {",
									"    pm.test('Usuario creado con contrase√±a robusta', function () {",
									"        var jsonData = pm.response.json();",
									"        pm.expect(jsonData.status).to.eql('success');",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"test.rn31.valid@gmail.com\",\n  \"password\": \"SuperSecure2024!\",\n  \"nombre\": \"Usuario\",\n  \"apellido\": \"RN31\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/register",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"auth",
								"register"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "RN32 - Validaci√≥n Cruzada de Al√©rgenos",
			"description": "Demostraci√≥n de validaci√≥n que previene activaci√≥n de planes con al√©rgenos del usuario",
			"item": [
				{
					"name": "0. Login Usuario Demo",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.data && jsonData.data.token) {",
									"        pm.collectionVariables.set('userToken', jsonData.data.token);",
									"        pm.test('‚úÖ Token obtenido', function () {",
									"            pm.expect(jsonData.data.token).to.be.a('string');",
									"        });",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"demo@nutritrack.com\",\n  \"password\": \"Demo123!\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/login",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"auth",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "‚ùå Activar plan con al√©rgenos (si usuario tiene alergias)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Si el usuario tiene alergias y el plan contiene esos al√©rgenos:",
									"// Status 400 con mensaje espec√≠fico",
									"// Si no tiene alergias o el plan es compatible: 201",
									"",
									"pm.test('RN32: Validaci√≥n de al√©rgenos ejecutada', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([201, 400]);",
									"});",
									"",
									"if (pm.response.code === 400) {",
									"    pm.test('Mensaje indica al√©rgenos incompatibles', function () {",
									"        var jsonData = pm.response.json();",
									"        pm.expect(jsonData.message).to.match(/al√©rgeno|alergia|ingrediente/i);",
									"    });",
									"}",
									"",
									"if (pm.response.code === 201) {",
									"    pm.test('Plan activado (usuario sin alergias o plan compatible)', function () {",
									"        var jsonData = pm.response.json();",
									"        pm.expect(jsonData.status).to.eql('success');",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{userToken}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"planId\": 1\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/usuario-planes/activar",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"usuario-planes",
								"activar"
							]
						}
					},
					"response": []
				},
				{
					"name": "‚úÖ Ver Planes del Cat√°logo (filtrados por al√©rgenos)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('RN32: Cat√°logo responde correctamente', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Planes listados (filtrados por RN32)', function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.be.an('array');",
									"    console.log('Total de planes disponibles:', jsonData.data.length);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{userToken}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/planes",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"api",
								"v1",
								"planes"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "üìä Resumen de Unit Tests",
			"description": "Informaci√≥n sobre la cobertura de tests unitarios",
			"item": [
				{
					"name": "README - Unit Tests Coverage",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								""
							]
						},
						"description": "# üß™ Cobertura de Unit Tests\n\n## Estad√≠sticas Generales\n- **Total Tests:** 175/175 ‚úÖ\n- **Failures:** 0\n- **Errors:** 0\n- **Cobertura:** 100%\n\n## Tests por Regla de Negocio\n\n### RN30 - Validaci√≥n de Email\n- `AuthServiceTest.testRegistro_EmailFormatoInvalido()` ‚úÖ\n- `AuthServiceTest.testRegistro_EmailDominioInexistente()` ‚úÖ\n- `AuthServiceTest.testRegistro_EmailValido()` ‚úÖ\n\n### RN31 - Pol√≠tica de Contrase√±as\n- `AuthServiceTest.testRegistro_PasswordCorta()` ‚úÖ\n- `AuthServiceTest.testRegistro_PasswordSinMayuscula()` ‚úÖ\n- `AuthServiceTest.testRegistro_PasswordSinNumero()` ‚úÖ\n- `AuthServiceTest.testRegistro_PasswordSinSimbolo()` ‚úÖ\n- `AuthServiceTest.testRegistro_PasswordComun()` ‚úÖ\n- `AuthServiceTest.testRegistro_PasswordContieneEmail()` ‚úÖ\n- `AuthServiceTest.testRegistro_PasswordValida()` ‚úÖ\n\n### RN32 - Validaci√≥n de Al√©rgenos\n- `UsuarioPlanServiceTest.testActivarPlan_ConAlergenosIncompatibles()` ‚úÖ\n- `UsuarioPlanServiceTest.testActivarPlan_SinAlergias()` ‚úÖ\n- `UsuarioPlanServiceTest.testActivarPlan_AlergiasPeroCompatibles()` ‚úÖ\n\n## Comando para Ejecutar Tests\n```bash\n./mvnw test\n```\n\n## Ubicaci√≥n de Tests\n- `src/test/java/com/example/nutritrackapi/service/AuthServiceTest.java`\n- `src/test/java/com/example/nutritrackapi/service/UsuarioPlanServiceTest.java`\n\n## Documentaci√≥n\nVer: `docs/REGLAS_NEGOCIO.MD` para detalles de implementaci√≥n"
					},
					"response": []
				}
			]
		}
	]
}